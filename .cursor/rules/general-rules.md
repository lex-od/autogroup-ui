# Основные правила разработки

## TypeScript

### Обязательные требования

- Строгая типизация во всех файлах
- Никогда не используй `any` - используй конкретные типы
- Всегда типизируй пропсы компонентов через `interface` или `type`
- Объявления типов всегда размещай рядом с основной сущностью, к которой они относятся, в том же файле
- Основная сущность для типа API-ответа - это API-запрос
- Не создавай отдельные файлы для типов
- Переиспользуй типы только в случае, если есть точное понимание, что это всегда будет один и тот же тип
- Не переиспользуй типы API ответов, т. к. они могут отличаться на практике

### Паттерны типизации

- Предпочитай `interface` вместо `type` для объектов

### Примеры

```typescript
// Правильно
interface UserProps {
  user: User;
  onUpdate: (user: User) => void;
}

// Неправильно
const UserComponent = (props: any) => {};
```

## React

### Работа с компонентами

- Всегда делай разбивку кода на компоненты, руководствуйся лучшими практиками
- Только функциональные компоненты
- Объявляй компоненты как стрелочную функцию, с типом `FC`
- Экспортируй компоненты с помощью дефолтного экспорта
- Деструктуризируй пропсы в параметрах функции
- Один компонент - один файл
- Глобальный, переиспользуемый компонент - это компонент, который используется в нескольких страницах или лейаутах, или размещается в папке для глобальных, переиспользуемых компонентов
- Самостоятельно не создавай глобальные, переиспользуемые компоненты
- Если есть необходимость создать глобальный, переиспользуемый компонент - запроси разрешение пользователя
- Если нужно добавить новые компоненты из shadcn/ui - запроси пользователя, чтобы он это сделал

### Именование и размещение компонентов

- Файл с компонентом называй в соответствии с названием компонента, в kebab-case
- Если компонент содержит дочерние компоненты - размещай файл компонента также в папке с соответствующим названием
- Дочерние компоненты размещай в папке с родительским
- Не создавай дополнительно папку `components` для дочерних компонентов
- Локальный, переиспользуемый компонент - это компонент, который используется в нескольких местах, в рамках одной страницы или лейаута
- Локальные, переиспользуемые компоненты размещай в ближайшей, общей папке, которая содержит все места использования этого компонента
- Никогда не размещай компоненты в файле `index.tsx`
- Никогда не делай реэкспорты в файле `index.tsx`

### Хуки и состояние

- Глобальный, переиспользуемый хук - это хук, который используется в нескольких страницах или лейаутах, или размещается в папке для глобальных, переиспользуемых хуков
- Самостоятельно не создавай глобальные, переиспользуемые хуки (исключение - хуки для API запросов)
- Если есть необходимость создать глобальный, переиспользуемый хук - запроси разрешение пользователя
- Используй `useCallback` и `useMemo` только при необходимости
- Избегай глубокой вложенности в `useEffect`

### Утилиты

- Утилиты размещай в файле с названием `component-name.utils.ts`, рядом с файлом компонента
- Создавай утилиты только когда это однозначно обосновано
- Не выноси в утилиты JSX
- Хуки не относятся к утилитам
- Глобальная, переиспользуемая утилита - это утилита, которая используется в нескольких страницах или лейаутах, или размещается в папке для глобальных, переиспользуемых утилит
- Самостоятельно не создавай глобальные, переиспользуемые утилиты
- Если есть необходимость создать глобальную, переиспользуемую утилиту - запроси разрешение пользователя

### React Context

- Не ипользуй React Context
- Вместо React Context используй zustand

### Mock-данные

- Выноси mock-данные в отдельный `.json` или `.ts` файл
- Называй файл с mock-данными по паттерну `mocked-calls.json` или `mocked-calls.ts`
- Файл с mock-данными размещай рядом с файлом основной сущности, к которой он относится
- При импорте и экспорте (если не дефолтный), называй переменную с mock-данными по паттерну `mockedCalls`

### Паттерны разработки

- Изменяй существующий функционал только если этого требует задача

### Примеры

```typescript
// Правильно
import { FC } from 'react';

interface CallCommentsProps {
  callId: string;
}

const CallComments: FC<CallCommentsProps> = ({ callId }) => {};

export default CallComments;
```

## Next.js

### Общие правила

- Используй только App Router (папка `app`)
- Никогда не используй экспериментальные фичи Next.js или других библиотек

### Зависимости и конфигурация проекта

- Самостоятельно не добавляй в проект новые зависимости и не обновляй существующие
- Если нужно добавить новые зависимости - всегда запрашивай пользователя, чтобы он это сделал
- Самостоятельно не изменяй глобальные конфигурационные файлы проекта (в т. ч. `globals.css`, `RootLayout`, `supabase.ts`, `environment.ts`, `components/core/*`)
- Если есть необходимость изменения глобальных конфигурационных файлов - запроси разрешение пользователя

### Структура страниц и лейаутов

- Файлы страниц `page.tsx` и лейаутов `layout.tsx` поддерживай в чистоте
- В стандартном случае, в `page.tsx` рендери только компонент соответствующего "экрана" из папки `screens`
- Вся основная логика и разметка страницы - в компоненте "экрана" и вложенных в него компонентах
- В стандартном случае, в `layout.tsx` (кроме `RootLayout`) рендери только компонент соответствующего "клиентского лейаута" из папки `client-layouts`, с оберткой `PrivateAccess` или `PublicAccess`
- Вся основная логика и разметка лейаута - в компоненте "клиентского лейаута" и вложенных в него компонентах
- Внутри папок `screens` и `client-layouts` руководствуйся правилами размещения и работы с компонентами

### Серверные роуты

- Проект использует отдельный backend, который реализован на Supabase
- Проект не использует Next.js для backend-функционала
- Никогда не создавай новые и не используй существующие серверные роуты Next.js (файлы `route.ts` в папке `app`)

## ESLint

### Обязательные правила

- Используй правила EsLint проекта (настройки в файле `eslint.config.mjs`)
- Используй все рекомендуемые правила Next.js
- Используй TypeScript ESLint правила
- Используй правила для React хуков
- Используй Prettier для форматирования (настройки в файле `.prettierrc`)
- После внесения изменений, всегда создавай билд, чтобы убедиться в отсутствии ошибок
- Если при создании билда возникли ошибки - исправляй

## Архитектура директорий проекта

```
autogroup-ui/
├── app/                         # Next.js App Router
│   ├── dashboard/               # Route group для dashboard
│   │   └── layout.tsx           # Layout для dashboard
│   ├── auth/                    # Аутентификация
│   │   └── layout.tsx           # Layout для auth
│   ├── globals.css              # Глобальные стили
│   ├── layout.tsx               # Root layout
├── components/                  # React компоненты
│   ├── ui/                      # Shadcn/ui компоненты (глобальные, переиспользуемые)
│   ├── ui-custom/               # Кастомные компоненты (глобальные, переиспользуемые)
│   ├── client-layouts/          # "Клиентские лейауты"
│   ├── screens/                 # "Компоненты экранов"
│   └── core/                    # Ключевые компоненты
├── lib/                         # Утилиты (глобальные, переиспользуемые) и конфигурация (глобальная)
│   └── utils.ts                 # Shadcn/ui утилиты
├── services/                    # Сервисы
├── stores/                      # Zustand stores
└── hooks/                       # Хуки (глобальные, переиспользуемые)
```

## Общие принципы файловой структуры

### Именование файлов

- Используй kebab-case для всех файлов, если иное явно не указано

### Организация импортов

- Используй импорт-алиасы (указаны в `tsconfig.json`)
- Сначала абсолютные импорты
- Затем относительные импорты с алиасами
- Затем импорты относительно текущего файла
